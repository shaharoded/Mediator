<?xml version="1.0" encoding="UTF-8"?>
<pattern name="GLUCOSE_MEASURE_ON_DISGLYCEMIA_PATTERN" concept-type="local-pattern">
    <categories>RoutineTreatment</categories>
    <description>Captures if glucose measurement was performed within a reasonable time frame after Dysglycemia (hyperglycemia or hypoglycemia)</description>
    <derived-from>
        <attribute name="DISGLYCEMIA_EVENT" tak="event" ref="A1"/>
        <attribute name="GLUCOSE_MEASURE" tak="raw-concept" idx="0" ref="E1"/>
    </derived-from>
 
    <!-- Rules always share "OR" relationship. To create more complex patterns, reference a pattern in a different pattern TAK -->
    <!-- By enforcing "before" we ensure 2 different instances are matched, "first" ensures these are the closest relevant instances are matched -->
    <!-- By enforcing "min-distance" we ensure a minimum time gap between anchor and event, meaning the test is not a "double check"-->
    <abstraction-rules>
        <rule>
            <!-- Relation between 2 KBTA objects -->
            <temporal-relation how='before' min-distance="8m" max-distance='24h'>
                <anchor>
                    <attribute ref="A1">
                        <allowed-value equal="Hyperglycemia"/>
                        <allowed-value equal="Hypoglycemia"/>
                    </attribute>
                </anchor>
                <event select='first'>
                    <attribute ref="E1">
                        <allowed-value min="20"/>
                    </attribute>
                </event>
            </temporal-relation>

            <!-- OPTIONAL: Compliance function to define fuzzy time window -->
            <compliance-function>
                <time-constraint-compliance>
                    <function name="id">
                        <trapez trapezA="8m" trapezB="8m" trapezC="8h" trapezD="24h"/>
                    </function>
                </time-constraint-compliance>
            </compliance-function>
        </rule>
    </abstraction-rules>
</pattern>